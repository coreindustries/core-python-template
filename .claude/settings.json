{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_FILE_PATH\" =~ \\.env|secrets|credentials|\\.pem|\\.key ]]; then echo '‚ùå BLOCKED: Cannot modify sensitive files (.env, secrets, credentials, keys). Use .env.example for templates.' && exit 1; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_COMMAND\" =~ prisma\\ migrate|prisma\\ db\\ push ]]; then if [ \"$ENVIRONMENT\" = 'production' ]; then echo '‚ö†Ô∏è WARNING: Database migration in production environment. Ensure you have a backup.' && read -p 'Continue? [y/N] ' -n 1 -r && echo && [[ $REPLY =~ ^[Yy]$ ]]; fi; fi"
          }
        ]
      },
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_FILE_PATH\" =~ tests/.*\\.py$ ]]; then if command -v uv &> /dev/null; then uv run pytest --cov=src --cov-report=term-missing --cov-fail-under=100 -q || echo '‚ö†Ô∏è Coverage below 100%. Run: uv run pytest --cov=src' >&2; fi; fi"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_FILE_PATH\" =~ src/.*\\.py$ ]]; then echo 'üí° Source files changed. Consider running: /test'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_COMMAND\" =~ uv\\ add|pip\\ install ]]; then echo 'üîí Dependencies changed. Consider running: /security-scan'; fi"
          }
        ]
      },
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_FILE_PATH\" =~ src/.*/(api|services)/.*\\.py$ ]]; then echo 'üìù New API/service added. Consider updating README.md or running: /document'; fi"
          }
        ]
      },
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_FILE_PATH\" =~ src/.*/api/.*\\.py$ ]]; then echo 'üìã New feature added. Verify PRD compliance with: /review --prd'; fi"
          }
        ]
      }
    ],
    "PostToolUseFailure": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_ERROR\" =~ ruff|mypy|SyntaxError ]]; then echo 'üí° Lint/type error detected. Try: /lint --fix'; fi"
          }
        ]
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$CLAUDE_ERROR\" =~ pytest|AssertionError|Test ]]; then echo 'üí° Test failure detected. Run: uv run pytest -xvv to see details'; fi"
          }
        ]
      }
    ]
  },
  "skills": {
    "directory": ".claude/skills",
    "enabled": [
      "new-feature",
      "new-prd",
      "security-scan",
      "db-migrate",
      "test",
      "lint",
      "review",
      "refactor",
      "document",
      "debug",
      "optimize"
    ]
  },
  "agents": {
    "code-reviewer": {
      "description": "Review code changes against project standards",
      "tools": ["Read", "Grep", "Glob"],
      "systemPrompt": "You are a code reviewer for a Python FastAPI project. Check code against the standards in prd/01_Technical_standards.md and .cursorrules. Focus on:\n- Type hints on ALL functions and class attributes\n- Google-style docstrings on public functions/classes\n- Naming conventions (snake_case for functions, PascalCase for classes)\n- DRY principle (no code duplication)\n- Test coverage (100% required)\n- Security best practices from prd/03_Security.md\n\nProvide constructive feedback with specific examples. Suggest improvements, not just problems."
    },
    "security-auditor": {
      "description": "Perform security analysis on code",
      "tools": ["Read", "Grep", "Bash"],
      "systemPrompt": "You are a security auditor for a Python FastAPI application. Check code against:\n- OWASP Top 10 (see prd/03_Security.md for detailed categories)\n- Project security standards in prd/03_Security.md\n- Common vulnerabilities: SQL injection, XSS, CSRF, insecure deserialization\n- Hardcoded secrets, credentials, API keys\n- Insecure authentication/authorization patterns\n- Missing input validation\n- Insecure error handling\n\nFor each finding, provide:\n1. OWASP category (A01-A10)\n2. Severity (Critical, High, Medium, Low)\n3. Specific code location\n4. Remediation example with code\n5. Reference to relevant PRD section"
    },
    "test-generator": {
      "description": "Generate tests for new code",
      "tools": ["Read", "Write", "Edit"],
      "systemPrompt": "You are a test generator for a Python project using pytest. Your goal is 100% test coverage.\n\nFollow these patterns:\n- Read tests/conftest.py for existing fixtures and patterns\n- Use pytest.mark.asyncio for async tests\n- Create both unit tests (tests/unit/) and integration tests (tests/integration/)\n- Use descriptive test names: test_<function>_<scenario>_<expected_result>\n- Test happy paths, edge cases, and error conditions\n- Use pytest fixtures for test data and mocks\n- Follow existing test structure and naming conventions\n\nFor each function/class, ensure:\n- All code paths are tested\n- All branches are covered\n- All error cases are handled\n- Integration tests for database/API operations"
    },
    "prd-compliance": {
      "description": "Check implementation against PRD requirements",
      "tools": ["Read", "Grep", "Glob"],
      "systemPrompt": "You are a PRD compliance checker. Compare implementations against PRD requirements in the prd/ directory.\n\nProcess:\n1. Read relevant PRD files (01_Technical_standards.md, 02_Tech_stack.md, 03_Security.md)\n2. Analyze the code implementation\n3. Check for:\n   - Compliance with technical standards (type hints, docstrings, naming)\n   - Correct technology stack usage (uv, FastAPI, Prisma, etc.)\n   - Security requirements adherence\n   - Test coverage requirements (100%)\n   - Code organization standards\n4. Generate a compliance report with:\n   - ‚úÖ Compliant items\n   - ‚ö†Ô∏è Partial compliance (with recommendations)\n   - ‚ùå Non-compliant items (with specific fixes)\n5. Suggest PRD updates if implementation reveals gaps in requirements"
    }
  },
  "mcp": {
    "servers": {
      "supabase": {
        "description": "Database operations and migrations via Supabase MCP",
        "enabled": false,
        "note": "Enable if using Supabase. Configure in Cursor MCP settings."
      },
      "github": {
        "description": "Repository management and PR creation",
        "enabled": false,
        "note": "Enable for GitHub integration. Requires GitHub token."
      },
      "firecrawl": {
        "description": "Documentation scraping and research",
        "enabled": false,
        "note": "Enable for web scraping and documentation research."
      },
      "context7": {
        "description": "Library documentation lookup",
        "enabled": false,
        "note": "Enable for quick access to library documentation."
      }
    }
  },
  "defaults": {
    "model": "sonnet",
    "autoCommit": false,
    "testOnSave": false,
    "contextWindow": "large",
    "readFilesOnDemand": true
  }
}
